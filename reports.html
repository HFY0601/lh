
<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>报表 - 多币种</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
body { font-family: 'system-ui', sans-serif; }
button { transition: all 0.3s ease; }
button:hover { opacity: 0.9; transform: scale(1.02); }
input, select {
  @apply border border-gray-300 rounded-xl px-3 py-2 text-sm focus:outline-none focus:ring-1 focus:ring-blue-500;
}
.card {
  @apply bg-white rounded-2xl shadow-md p-5 transition hover:shadow-lg;
}
</style>

</head>
<body class="bg-gray-50 text-gray-800 text-sm">
<nav class="flex justify-between px-4 py-3 bg-white shadow text-sm font-medium text-gray-600 max-w-3xl mx-auto">
  <a href="index.html" class="hover:text-blue-600">首页</a>
  <a href="assets.html" class="hover:text-blue-600">资产</a>
  <a href="debts.html" class="hover:text-blue-600">负债</a>
  <a href="reports.html" class="text-blue-600 font-bold">报表</a>
  <a href="profile.html" class="hover:text-blue-600">我的</a>
</nav>
 class="bg-gray-50 text-sm text-gray-800">
<nav class="flex justify-between px-4 py-3 bg-white shadow text-sm font-medium text-gray-600 max-w-3xl mx-auto">
  <a href="index.html">首页</a>
  <a href="assets.html">资产</a>
  <a href="debts.html">负债</a>
  <a href="reports.html" class="text-blue-600 font-bold">报表</a>
  <a href="profile.html">我的</a>
</nav>

<main class="max-w-3xl mx-auto px-4 py-6 space-y-6">
  <section class="card space-y-3">
    <h2 class="text-base font-semibold text-gray-700">添加记录</h2>
    <form id="recordForm" class="grid grid-cols-1 md:grid-cols-2 gap-3">
      <select id="recordType" class="border rounded-xl p-2">
        <option value="收入">收入</option>
        <option value="支出">支出</option>
      </select>
      <input id="recordCategory" placeholder="分类（如 工资 / 餐饮）" class="border rounded-xl p-2" required />
      <input id="recordAmount" type="number" placeholder="金额" class="border rounded-xl p-2" required />
      <input id="recordDate" type="date" class="border rounded-xl p-2" required />
      <select id="recordCurrency" class="border rounded-xl p-2">
        <option value="CNY">人民币</option>
        <option value="USD">美元</option>
        <option value="HKD">港币</option>
        <option value="EUR">欧元</option>
      </select>
      <button type="submit" class="col-span-2 bg-green-600 text-white py-2 rounded-xl">添加记录</button>
    </form>
  </section>

  <section class="card space-y-4">
    <div class="flex flex-wrap gap-3 justify-between items-center">
      <h2 class="text-base font-semibold text-gray-700">📊 收支趋势图</h2>
      <div class="flex gap-2 items-center text-xs">
        <label>币种：</label>
        <select id="currencySelect" class="border p-1 rounded">
          <option value="CNY">人民币</option>
          <option value="USD">美元</option>
          <option value="HKD">港币</option>
          <option value="EUR">欧元</option>
        </select>
        <label>维度：</label>
        <select id="filterMode" class="border p-1 rounded">
          <option value="month">月</option>
          <option value="quarter">季</option>
        </select>
      </div>
    </div>
    <canvas id="trendChart" height="300"></canvas>
  </section>
</main>

<script>
const rates = {{ USD: 7.1, HKD: 0.91, EUR: 7.8, CNY: 1 }}; // 汇率静态配置

document.getElementById("recordForm").onsubmit = e => {
  e.preventDefault();
  const t = document.getElementById("recordType").value;
  const c = document.getElementById("recordCategory").value;
  const a = parseFloat(document.getElementById("recordAmount").value);
  const d = document.getElementById("recordDate").value;
  const cur = document.getElementById("recordCurrency").value;
  if (!c || isNaN(a) || !d) return alert("请完整输入");

  const tx = JSON.parse(localStorage.getItem("transactions") || "[]");
  tx.push({ type: t, category: c, amount: a, date: d, currency: cur });
  localStorage.setItem("transactions", JSON.stringify(tx));
  e.target.reset();
  loadTrends();
};

function getPeriod(dateStr, mode) {
  const d = new Date(dateStr);
  if (mode === "quarter") return d.getFullYear() + "Q" + (Math.floor(d.getMonth() / 3) + 1);
  return d.getFullYear() + "-" + String(d.getMonth() + 1).padStart(2, '0');
}

function loadTrends() {
  const tx = JSON.parse(localStorage.getItem("transactions") || "[]");
  const mode = document.getElementById("filterMode").value;
  const currency = document.getElementById("currencySelect").value;

  const incomeMap = {}, expenseMap = {}, labelsSet = new Set();

  tx.forEach(t => {
    const key = getPeriod(t.date, mode);
    const rate = rates[t.currency] || 1;
    const baseAmount = t.amount * (t.currency === currency ? 1 : rate / rates[currency]);
    labelsSet.add(key);
    if (t.type === "收入") incomeMap[key] = (incomeMap[key] || 0) + baseAmount;
    if (t.type === "支出") expenseMap[key] = (expenseMap[key] || 0) + baseAmount;
  });

  const labels = Array.from(labelsSet).sort();
  const income = labels.map(k => incomeMap[k] || 0);
  const expense = labels.map(k => expenseMap[k] || 0);
  const net = labels.map((_, i) => income[i] - expense[i]);

  const ctx = document.getElementById("trendChart").getContext("2d");
  if (window.trendChart) window.trendChart.destroy();
  window.trendChart = new Chart(ctx, {
    type: "bar",
    data: {
      labels,
      datasets: [
        { type: "bar", label: "收入", data: income, backgroundColor: "#10b981" },
        { type: "bar", label: "支出", data: expense, backgroundColor: "#ef4444" },
        { type: "line", label: "结余", data: net, borderColor: "#3b82f6", tension: 0.3 }
      ]
    },
    options: {
      responsive: true,
      plugins: { legend: { position: "bottom" } },
      scales: { y: { beginAtZero: true } }
    }
  });
}

document.getElementById("currencySelect").onchange =
document.getElementById("filterMode").onchange = loadTrends;
loadTrends();
</script>
</body>
</html>
